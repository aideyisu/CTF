# nmap 漏洞扫描

Web扫描 AWVS,APPscan,Netspark

系统扫描 nessus,nmap(端口扫描)

## 功能架构

主机发现->端口扫描->版本探测->OS探测

## 主机探测

-sn 只进行主机探测,不扫描端口

-sS表示使用TCP SYN方式扫描TCP端口

-sU表示扫描UDP端口

#### 使用演示

nmap -sS -sU -T4 -top-ports 300 x.x.x.x

解释:扫描TCP端口,UDP端口 时间级别配置4级,为了更快执行! 扫描最有可能开放的300个端口(TCP,UDP)各300个

## 针对某一台主机进行漏洞扫描

nmap x.x.x.x --script=xxx(脚本)

## OS探测

nmap -O x.x.x.x

## 判断常见端口并对端口进行扫描

nmap x.x.x.x --script=auth vuln

## 官网教程

不带参数运行nmap的时候会给出最常用选项,但不能代替深入文档,一些不常用参数没有在此被展示

## 主机探测

在网络探测任务中,第一步将一堆IP范围缩减为有限的主机列表,因为扫描每个IP地址的每个端口肯定很慢=。=

主机探测的需求是如此多样,有时主机探测会被叫做ping扫描,但主机探测远远超出了无处不在的ping工具关联的简单ICMP回显请求数据包

我们可以通过列表扫描-sL、跳过主机发现-Pn、任意组合多端口TCP SYN / ACK UDP SCTP INIT ICMP等探针探测

#### 主机探测参数

###### -sL 列表扫描

仅列出指定网络中的每个主机,而不会将任何数据包发丝包裹带中国用户

nmap进行反响dns解析以了解其名称,简单的主机名提供不可思议的信息.例如fw.chi是一家芝加哥防火墙的名称

nmap还会报告IP地址总数,但是知识打印目标主机列表,不能与更高级别功能(端口扫描,操作系统检测,主机发现)

###### -sn 无端口扫描

让nmap在主机发现之后不执行端口扫描,并且仅仅打印出相应主机发现探针的可用主机.这通常被称为ping扫描,可以对目标网络轻型侦查,不会引起太多关注

对系统管理员也很有价值.可以轻松地用于计算网络上的可用计算机或监视服务器可用性

###### -Pn 无ping

完全跳过主机发现阶段.混用主机发现会导致nmap尝试针对每个IP地址请求的扫描功能(这句不是人话啊喂)

###### -PS <port list> TCP确认ping

###### -PU <port list> UDP确认ping

...还有很多暂时省略

## 端口扫描

nmap最初是一个高效的端口扫描程序,至今仍然是其核心功能

直接使用 nmap <target>即可直接扫描主机上的1000个TCP端口

nmap将端口状态分为6种

1 open 打开

在此端口上积极接受TCP链接,UDP数据报文,SCTP关联

2 cloase 关闭

一个关闭的端口可以被访问(接收并响应nmap探测数据包),但没有应用程序监听它

3 已过滤

nmap无法确定开关状态,因为数据包筛选会阻止探针到达端口.过滤可能来自专用防火墙设备

4 未过滤

可以访问端口,但是nmap无法确定端口打开关闭状态.仅用于映射防火墙规则集的ACk扫描将端口归为此类

5 打开 | 过滤

nmap无法确定端口是打开还是已过滤 对于打开端口不响应的扫描会发生这种问题

6 封闭

nmap无法确定端口是关闭还是已过滤,仅用于IP ID空闲扫描

-sS TCP-SYN扫描

-sT TCP-链接扫描(默认)

-sU UDP扫描

-sY SCTP iNIT扫描 (SCTP是TCp\UDP协议的一个较新的替代方案）

-sN -sF -sX (TCP NULL, FIN, Xmacs扫描)

具体操作 不设置任何位(tcp 标志头为0),仅设置TCP fin位,圣诞扫描

-sA TCP-ACK扫描

-sW TCP-窗口扫描

-sM TCP Maimon扫描探针为FIN/ACK 

--scanflags 自定义TCP扫描

...

## 端口规格和扫码顺序

nmap还要指定那些端口以及扫描顺序是随即还是顺序

-p <port range>

-F (快速(受限端口)扫描) 将默认的1000端口缩减为100个

...

## 服务和版本扫描

-sV 版本检测

--allports 不要从版本检测中排除任何端口

--version-intensity <intensity> （设置版本扫描强度）强度级别指定应使用的探针。数字越高，就越有可能正确识别服务。但是，高强度扫描需要更长的时间。强度必须在0到9之间。 预设值为7

--version-all （尝试每一个探针）

别名--version-intensity 9，确保对每个端口尝试每个探测。

## 操作系统检测

pass

## 时间和性能

性能是nmap优先级最高事项之一, 本地网络主机的默认扫描几乎不消耗时间,但是扫描成百上千台主机的时候会大大增加扫描时间,此外很多选项也会大大延长时间,

一些选项支持time参数,可以在后面附加ms,s,m,h指定(默认为秒)

#### --min-hostgroup <numhosts> 和 --max-hostgroup 调整并行扫描组大小

nmap可以并行扫描多个主机.通过将IP空间划分为多个小组,然后一次扫描一个组来做到这一点。较大的小组效率更高,但是直至整个小组结束才有报告

默认nmap采取冲突对折方法,以最低5个小组开始，随后将小组增加到1024个

指定max时,nmap小组永远不会超过该大小;min会尝试将小组大小保持在该级别以上

#### --min-parallelism <numprobes>; （调整探针并行化） --max-parallelism <numprobes>

控制主机组可能未变化的探针总数,用于端口扫描和主机发现。默认情况nmap会根据网络性能计算并不断变化理想并行情况.若证明网络不可靠并行度可以降低为1,而理想条件下可以提升至数百

最常见的做法是min设置为大于1,以加快对性能不佳主机或网络的扫描速度.这有些冒进,因为设置太高会影响准确性,还会降低nmap动态控制并行的能力.一般10可能是合理的,只在不得已时才会调整此选项

#### --host-timeout <time> 放弃慢速目标主机

慢速可能由于性能不佳,不可靠的网络软硬件,数据包速率限制,或限制性防火墙引起.

最慢的少数主机占用了大部分计算机性能,

#### 还有一堆...

https://nmap.org/book/man-performance.html

放个链接以后自己看=。=
